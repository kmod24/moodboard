<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mood Dayboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #0b0f14;
      --panel: #111722;
      --panel-2: #0e141d;
      --text: #e9eef5;
      --muted: #a6b3c3;
      --accent: #6ee7b7; /* changes dynamically based on mood */
      --ring: rgba(110,231,183,.45);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      color-scheme: dark;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 80% -10%, #1b2433 0%, #0b0f14 60%);
      color: var(--text); font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .wrap { max-width: 960px; margin: 40px auto; padding: 0 20px; }
    header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 18px; }
    .brand { display:flex; align-items:center; gap:10px; }
    .logo { width:40px; height:40px; border-radius:12px; background: linear-gradient(135deg, var(--accent), #60a5fa); box-shadow: var(--shadow); }
    h1 { margin: 0; font-size: 28px; letter-spacing: .2px; }
    .card {
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 16px; box-shadow: var(--shadow);
      padding: 18px; margin-top: 14px;
    }
    label { display:block; font-weight:600; margin-bottom: 6px; color: var(--muted); }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    input[type="text"]{
      flex:1; min-width: 240px; padding: 12px 14px;
      border-radius: 12px; border:1px solid rgba(255,255,255,.08);
      background: #0c121a; color: var(--text); outline: none;
    }
    input[type="text"]:focus { border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); }
    button {
      padding: 12px 16px; border-radius: 12px; border:1px solid rgba(255,255,255,.08);
      background: var(--accent); color:#062312; font-weight:700; cursor:pointer;
      transition: transform .04s ease;
    }
    button:hover { transform: translateY(-1px); }
    button[disabled]{ opacity:.6; cursor:not-allowed; transform:none; }
    .hint { color: var(--muted); font-size: 13px; margin-top: 8px; }
    .tags { display:flex; gap:8px; flex-wrap:wrap; margin-top: 10px; }
    .tag {
      padding: 6px 10px; border-radius: 999px; border:1px solid rgba(255,255,255,.08);
      background:#0c121a; color: var(--text); font-size: 13px;
    }
    .grid { display:grid; gap:12px; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); margin-top: 12px; }
    img { width:100%; height:180px; object-fit:cover; border-radius: 12px; border:1px solid rgba(255,255,255,.06); }
    .divider { height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent); margin: 14px 0; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#0c121a; border:1px solid rgba(255,255,255,.08); }
    .coffee { font-weight:600; }
    .mood-choices { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px;}
    .chip { padding:8px 12px; border-radius:10px; background:#0c121a; border:1px solid rgba(255,255,255,.08); cursor:pointer; }
    .chip:hover { border-color: var(--accent); }
    /* Loader + toast */
    .status { min-height: 20px; margin-top:8px; color: var(--muted); }
    .spinner { width:18px; height:18px; border-radius:50%; border:3px solid rgba(255,255,255,.15); border-top-color: var(--accent); animation: spin 1s linear infinite; display:inline-block; vertical-align:-4px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .toast { position: fixed; right: 18px; bottom: 18px; background:#111722; border:1px solid rgba(255,255,255,.1); padding:10px 12px; border-radius:12px; box-shadow: var(--shadow); display:none; }
    .small { font-size: 13px; color: var(--muted); }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>moodboard</h1>
      </div>
    </header>

    <section class="card" aria-labelledby="moodFormTitle">
      <h2 id="moodFormTitle" style="margin:0 0 8px 0; font-size:18px; color:var(--muted);">Describe your mood</h2>
      <label for="mood">One word</label>
      <div class="row">
        <input id="mood" type="text" placeholder="happy, sad, chill, ..."/>
        <button id="goBtn" onclick="createDayboard()">Create Dayboard</button>
      </div>
      <div class="mood-choices" aria-label="Quick choices">
        <span class="chip" onclick="pick('happy')">üòä happy</span>
        <span class="chip" onclick="pick('chill')">üßä chill</span>
        <span class="chip" onclick="pick('sad')">üåßÔ∏è sad</span>
        <span class="chip" onclick="pick('focused')">üéØ focused</span>
        <span class="chip" onclick="pick('confident')">üí™ confident</span>
      </div>
      <div id="status" class="status" aria-live="polite"></div>
      <p class="hint">Tip: press <kbd>Enter</kbd> to submit.</p>
    </section>

    <section id="result" class="card" style="display:none;">
      <div class="row" style="justify-content:space-between;">
        <h2 style="margin:0;">Your Dayboard</h2>
        <span id="accentSwatch" class="pill small">Mood: <strong id="moodLabel">‚Äî</strong></span>
      </div>

      <div class="divider"></div>

      <div style="display:flex; flex-wrap:wrap; gap:14px; align-items:center;">
        <span class="pill">‚òï <span class="coffee" id="coffee">‚Äî</span></span>
        <div class="tags" id="songs"></div>
      </div>

      <div class="divider"></div>

      <div class="tags" id="outfits"></div>

      <div class="grid" id="images"></div>
    </section>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    const statusEl = document.getElementById('status');
    const toast = document.getElementById('toast');
    const result = document.getElementById('result');
    const moodInput = document.getElementById('mood');
    const goBtn = document.getElementById('goBtn');

    function pick(word){ moodInput.value = word; createDayboard(); }
    moodInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') createDayboard(); });

    function setAccentByMood(mood){
      const map = {
        happy: '#f6c453',
        chill: '#6ee7b7',
        sad:   '#93c5fd',
        focused:'#f472b6',
        confident:'#fde047'
      };
      document.documentElement.style.setProperty('--accent', map[mood?.toLowerCase()] || '#6ee7b7');
      document.documentElement.style.setProperty('--ring', hexToRing(map[mood?.toLowerCase()] || '#6ee7b7'));
    }
    function hexToRing(hex){
      try{
        const c = hex.replace('#',''); const r=parseInt(c.substring(0,2),16), g=parseInt(c.substring(2,4),16), b=parseInt(c.substring(4,6),16);
        return `rgba(${r},${g},${b},.35)`;
      } catch { return 'rgba(110,231,183,.35)'; }
    }

    function showToast(msg){
      toast.textContent = msg;
      toast.style.display = 'block';
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> toast.style.display='none', 2400);
    }

    async function createDayboard() {
      const mood = moodInput.value.trim();
      if (!mood) { showToast('Type a mood word'); return; }
      setAccentByMood(mood);
      goBtn.disabled = true;
      statusEl.innerHTML = '<span class="spinner" aria-hidden="true"></span> Generating...';

      try {
        const r = await fetch("/dayboard", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ mood_word: mood })
        });
        if (!r.ok) throw new Error(`${r.status} ${r.statusText}`);
        const data = await r.json();

        // render
        document.getElementById('moodLabel').textContent = data.mood_word;
        document.getElementById('coffee').textContent = data.coffee;

        const songs = (data.songs || []).map(s => `<span class="tag">üéµ ${escapeHtml(s)}</span>`).join("");
        document.getElementById('songs').innerHTML = songs;

        const outfits = (data.outfits || []).map(o => `<span class="tag">üëó ${escapeHtml(o)}</span>`).join("");
        document.getElementById('outfits').innerHTML = outfits;

        const imgs = (data.images || []).map(u => {
  if (typeof u === 'string' && (u.startsWith('http') || u.startsWith('data:image'))) {
    return `<img loading="lazy" src="${u}" alt="${data.mood_word} mood image">`;
  }
  return `<div class="tag">${escapeHtml(String(u))}</div>`;
}).join("");

document.getElementById('images').innerHTML = imgs;  // <- add this



        result.style.display = 'block';
        statusEl.textContent = '';
      } catch (e) {
        console.error(e);
        statusEl.textContent = '';
        showToast('Request failed. Is the server running?');
      } finally {
        goBtn.disabled = false;
        moodInput.focus();
      }
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
  </script>
</body>
</html>
